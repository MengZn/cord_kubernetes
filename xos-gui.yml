---
app: apps/v1
kind: Deployment
metadata:
  name: xos-gui
  labels:
    app: xos-gui
spec:
  replicas: 1
  selector:
    matchLabels:
      app: xos-gui
  template:
    metadata:
      labels:
        app: xos-gui
    spec:
      containers:
      - name: xos-gui
        image: xosproject/xos-gui:master
        ports:
        - containerPort: 4000
        env:
        - name: SERVICE_4000_NAME
          value: "xos-gui"
        - name: SERVICE_80_IGNORE
          value: "yes"
        volumeMounts:
        - name: style
          mountPath: /var/www/dist/style.config.js
        - name: app
          mountPath: /var/www/dist/app.config.js
      initContainers:
      - name: gui-extensions-store
        image: jason0330/node
        command: 
        - "/bin/true"
        volumeMounts:
        - mountPath: /var/www/dist/extensions
          name: extensions
      - name: gui-extension-vtr
        image: xosproject/gui-extension-vtr:master
        command: 
        - "/bin/sh"
        args: 
        - "-c"
        - "mkdir"
        - "-p"
        - "/var/www/dist/extensions/vtr/"
        - "&&"
        - "cp"
        - "-R"
        - "/tmp/* /var/www/dist/extensions/vtr/"
        volumeMounts:
        - mountPath: /var/www/dist/extensions
          name: extensions
      - name: gui-extension-rcord
        image: xosproject/gui-extension-rcord:master
        command: 
        - "/bin/sh"
        args: 
        - "-c"
        - "mkdir"
        - "-p"
        - "/var/www/dist/extensions/rcord/"
        - "&&"
        - "cp"
        - "-R"
        - "/tmp/* /var/www/dist/extensions/rcord/"
        volumeMounts:
        - mountPath: /var/www/dist/extensions
          name: extensions
  volumes:
  - name: style
    hostPath:
      path: /opt/cord_profile/style.config.js
  - name: app
    hostPath:
      path: /opt/cord_profile/app.config.js
  - name: extensions
    emptyDir: {}